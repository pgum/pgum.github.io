<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">

  <title>Part 1 - Preparation with Hyper-V on Windows</title>

  <meta name="author" content="Piotr Jacek Gumulka" />

  
  <meta name="description" content="My name is Piotr Jacek Gumulka. I help projects, teams and individuals find the way to achieve their business objectives.  
I am DevOps engineer, servant leader, university lecturer and public speaker open to new challenges.
">
  

  <link rel="alternate" type="application/rss+xml" title="gumulka.net - the notepad of ideas" href="/feed.xml" />

  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160061743-1"></script>
    <script>
          window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160061743-1');
</script>


  
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T6FH4Z6');</script>
    <!-- End Google Tag Manager -->


  


  
    
      
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/assets/css/main.css" />
    
      <link rel="stylesheet" href="/assets/css/scroll-to-top.css" />
    
  

  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  
  
  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="Part 1 - Preparation with Hyper-V on Windows" />
  

   
  <meta property="og:description" content="During this tutorial we will create first layer of our architecture. The goal here is to have following: virtual switch, named bridged, that uses our physical netword device and serves as a bridge for VM network adapters 1 load-balancer node, haproxy - runs on CentOS 7 - IP: 10.0.10.200 -...">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="/devops/1-preparation/" />
  <link rel="canonical" href="/devops/1-preparation/" />
  

  
  <meta property="og:image" content="/me/photo_sqar_small.jpg" />
  


  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <meta name="twitter:creator" content="@" />

  
  <meta name="twitter:title" content="Part 1 - Preparation with Hyper-V on Windows" />
  

  
  <meta name="twitter:description" content="During this tutorial we will create first layer of our architecture. The goal here is to have following: virtual switch, named bridged, that uses our physical netword device and serves as a bridge for VM network adapters 1 load-balancer node, haproxy - runs on CentOS 7 - IP: 10.0.10.200 -...">
  

  
  <meta name="twitter:image" content="/me/photo_sqar_small.jpg" />
  


<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/site.webmanifest">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
<script>
	document.write( '<link rel="stylesheet" href="/assets/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
</script>
<script src="/assets/js/jquery-3.7.0.min.js"></script>
<script src="/assets/js/jQWCloudv3.4.1.js"></script>
<script src="/assets/js/isotope.pkgd.min.js"></script>


</head>


  <body>

    
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T6FH4Z6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->


  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
        <style>
.navbar-header button { float: left !important; margin-left:15px;}
.navbar-header {
    display: inline-block; }

      </style>

    <div class="navbar-header">

      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button><a class="navbar-brand" href="/gumulka.net">gumulka.net</a>
</div>
    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav">
<li class="devops"><a href="/devops">DevOps</a></li>
<li class="slides"><a href="/slides">Slides</a></li>
        
        
          <li class="checklists"><a href="/notes#checklists">checklists</a></li>
          <li class="concepts"><a href="/notes#concepts">concepts</a></li>
          <li class="scenarios"><a href="/notes#scenarios">scenarios</a></li>
<li class="notes"><a href="/notes">All</a></li>
          <li class="tags"><a href="/tags">by Tag</a></li>
      </ul>
    </div>

	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1">
        <div class="page-heading">
          <h1>Part 1 - Preparation with Hyper-V on Windows</h1>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class="container" role="main">
  <div class="row">
    <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2">
<a href="#before-we-start">Before we start</a>
<ul>
<li class="toc-entry toc-h3"><a href="#networking">Networking</a></li>
<li class="toc-entry toc-h3"><a href="#get-the-os-images">Get the OS images</a></li>
<li class="toc-entry toc-h3"><a href="#free-up-your-storage">Free up your storage</a></li>
<li class="toc-entry toc-h3"><a href="#close-chrome-and-discord-for-a-second">Close Chrome and Discord for a second</a></li>
<li class="toc-entry toc-h3"><a href="#administrative-privileges-in-windows">Administrative privileges in Windows</a></li>
<li class="toc-entry toc-h3"><a href="#generate-ssh-keys">Generate ssh keys</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#setup-hyper-v-infrastructure">Setup Hyper-V infrastructure</a>
<ul>
<li class="toc-entry toc-h3"><a href="#create-virtual-switch">Create virtual switch</a></li>
<li class="toc-entry toc-h3"><a href="#create-a-bunch-of-vms-configuring-them">Create a bunch of VMs, configuring them</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#install-os-on-vms">Install OS on VMs</a>
<ul>
<li class="toc-entry toc-h3"><a href="#haproxy">HAProxy</a></li>
<li class="toc-entry toc-h3"><a href="#control-plane-and-worker-nodes">Control plane and worker nodes</a></li>
<li class="toc-entry toc-h3"><a href="#ansible-part-1">Ansible part 1</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#spraying-k8s-cluster-on-top">Spraying k8s cluster on top</a></li>
<li class="toc-entry toc-h2"><a href="#getting-k8s-credentials">Getting k8s credentials</a></li>
<li class="toc-entry toc-h2"><a href="#possible-upgrades-in-the-future">Possible upgrades in the future</a></li>
</ul>
<p>During this tutorial we will create first layer of our architecture. The goal here is to have following:</p>
<ul>
  <li>virtual switch, named <code class="language-plaintext highlighter-rouge">bridged</code>, that uses our physical netword device and serves as a bridge for VM network adapters</li>
  <li>1 load-balancer node, <code class="language-plaintext highlighter-rouge">haproxy</code> - runs on CentOS 7 - IP: <code class="language-plaintext highlighter-rouge">10.0.10.200</code> - MAC: <code class="language-plaintext highlighter-rouge">00:15:5D:0A:0A:00</code>
</li>
  <li>3 main nodes, <code class="language-plaintext highlighter-rouge">cplane-0..2</code> - run on Ubuntu 22.04 - IP: <code class="language-plaintext highlighter-rouge">10.0.10.20{1..3}</code> - MAC: <code class="language-plaintext highlighter-rouge">00:15:5D:0A:0A:0{1..3}</code>
</li>
  <li>2 worker nodes, <code class="language-plaintext highlighter-rouge">worker-0..1</code> - run on Ubuntu 22.04 - IP: <code class="language-plaintext highlighter-rouge">10.0.10.20{4..5}</code> - MAC: <code class="language-plaintext highlighter-rouge">00:15:5D:0A:0A:0{4..5}</code>
</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ┌───────────────┐                     ┌───────────────┐                 
  │  10.0.10.201  │                     │  10.0.10.204  │                 
  │  ┌────────────┴──┐     ┌─────────┐  │  ┌────────────┴──┐             
  │  │  10.0.10.202  │     │ ....200 │  │  │  10.0.10.205  │             
  │  │  ┌────────────┴──┐  │ HAproxy │  │  │               │             
  └──┤  │  10.0.10.203  │  │         │  └──┤ Worker nodes  │             
     │  │               │  └─────────┘     │               │             
     └──┤ C-plane nodes │                  └───────────────┘             
        │               │                                                 
        └───────────────┘                                                 
</code></pre></div></div>

<p>We are going to use Hyper-V for it. Hyper-V is a native hypervisor for Windows. It was first released alongside Windows Server 2008, and has been available on most versions of Windows since Windows 8. Hyper-V allows you to create and manage virtual machines on your Windows system. However, it’s only available on 64-bit versions of Windows and requires specific hardware capabilities.</p>

<h2 id="before-we-start">
<a class="anchor" href="#before-we-start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Before we start</h2>

<h3 id="networking">
<a class="anchor" href="#networking" aria-hidden="true"><span class="octicon octicon-link"></span></a>Networking</h3>

<p>I use MAC addresses to assign IP for those machines on my home router. Unfortunately I had to click manually to assign MACs with IPs. If you are more lucky with your router, and can run OpenWRT, you can use something like that:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">COUNTER_HEX</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'%x\n'</span> <span class="nv">$COUNTER</span><span class="si">)</span>
uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span><span class="k">${</span><span class="nv">IP_ADDRESS_PREFIX</span><span class="k">}${</span><span class="nv">COUNTER</span><span class="k">}</span>
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span><span class="k">${</span><span class="nv">MAC_ADDRESS_PREFIX</span><span class="k">}${</span><span class="nv">COUNTER_HEX</span><span class="k">}</span>
uci commit dhcp
/etc/init.d/dnsmasq restart
</code></pre></div></div>
<p>with filling out the rest of the script for yourself <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20"></p>

<p>What is more, we utilize <code class="language-plaintext highlighter-rouge">/etc/hosts</code> Windows file located in <code class="language-plaintext highlighter-rouge">%SystemRoot%\System32\drivers\etc\hosts</code>. Adding following lines will make our VMs recognizable by descriptive name instead of IP address:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">10.0.10.200</span><span class="w"> </span><span class="n">haproxy.k8s.local</span><span class="w"> </span><span class="n">haproxy</span><span class="w"> 
</span><span class="m">10.0.10.201</span><span class="w"> </span><span class="n">cplane</span><span class="m">-0</span><span class="n">.k8s.local</span><span class="w"> </span><span class="n">cplane</span><span class="m">-0</span><span class="w">
</span><span class="m">10.0.10.202</span><span class="w"> </span><span class="n">cplane</span><span class="m">-1</span><span class="n">.k8s.local</span><span class="w"> </span><span class="n">cplane</span><span class="m">-1</span><span class="w">
</span><span class="m">10.0.10.203</span><span class="w"> </span><span class="n">cplane</span><span class="m">-2</span><span class="n">.k8s.local</span><span class="w"> </span><span class="n">cplane</span><span class="m">-2</span><span class="w">
</span><span class="m">10.0.10.204</span><span class="w"> </span><span class="n">worker</span><span class="m">-0</span><span class="n">.k8s.local</span><span class="w"> </span><span class="n">worker</span><span class="m">-0</span><span class="w">
</span><span class="m">10.0.10.205</span><span class="w"> </span><span class="n">worker</span><span class="m">-1</span><span class="n">.k8s.local</span><span class="w"> </span><span class="n">worker</span><span class="m">-1</span><span class="w">
</span></code></pre></div></div>

<p>WSL generate <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file by default from what is set on Windows. To disable this, edit <code class="language-plaintext highlighter-rouge">/etc/wsl.conf</code> with editor of choice with <code class="language-plaintext highlighter-rouge">sudo</code>, and add following entry:</p>
<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[network]</span>
<span class="py">generateHosts</span> <span class="p">=</span> <span class="s">False</span>
</code></pre></div></div>
<p>Be aware that you would need to keep <code class="language-plaintext highlighter-rouge">hosts</code> file on your own, but it will never get overwritten unexpectedly by WSL.</p>

<p>Fun fact, my router for some reason did not liked one of the IP assignments, and seemed to ignore my kind request to cooperate. If you are for any reason in similar situation, remember, that you can always change <code class="language-plaintext highlighter-rouge">netcfg</code> on VM for it use manual IP assignment. For example <code class="language-plaintext highlighter-rouge">/etc/netplan/01-netcfg.yaml</code> that could do the work:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">network</span><span class="pi">:</span>
  <span class="na">version</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">renderer</span><span class="pi">:</span> <span class="s">networkd</span>
  <span class="na">ethernets</span><span class="pi">:</span>
    <span class="na">eth0</span><span class="pi">:</span>
      <span class="na">dhcp4</span><span class="pi">:</span> <span class="s">no</span>
      <span class="na">addresses</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">10.0.10.201/16</span><span class="pi">]</span>
      <span class="na">gateway4</span><span class="pi">:</span> <span class="s">10.0.10.254</span>
      <span class="na">nameservers</span><span class="pi">:</span>
        <span class="na">addresses</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">8.8.8.8</span><span class="pi">,</span><span class="nv">8.8.4.4</span><span class="pi">]</span>
</code></pre></div></div>

<h3 id="get-the-os-images">
<a class="anchor" href="#get-the-os-images" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get the OS images</h3>

<p>For this setup we will use:</p>

<ul>
  <li>
<a href="http://isoredirect.centos.org/centos/7/isos/x86_64/">CentOS 7 Minimal 2009</a> - <code class="language-plaintext highlighter-rouge">CentOS-7-x86_64-Minimal-2009</code>- for HAproxy VM.</li>
  <li>
<a href="https://releases.ubuntu.com/jammy/">Ubuntu 22.04 Server</a> - <code class="language-plaintext highlighter-rouge">Ubuntu-22.04.4-live-server-amd64</code> - for  cplane and worker VMs.</li>
</ul>

<p>Any linux distro will work I guess, these are the ones I chose to do this exercise on.</p>

<h3 id="free-up-your-storage">
<a class="anchor" href="#free-up-your-storage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Free up your storage</h3>

<p>I assume 40GB storage per cplane and worker node. I advise setting no less than 20GB. I experienced failures in setup or later in running the system, that it going lower than 20 gigs is risky.<br>
HAproxy server can be light and tiny.</p>

<h3 id="close-chrome-and-discord-for-a-second">
<a class="anchor" href="#close-chrome-and-discord-for-a-second" aria-hidden="true"><span class="octicon octicon-link"></span></a>Close Chrome and Discord for a second</h3>

<p>Fun fact, Hyper-V will throw error if it cannot reserve required amount of memory in the system. How do I know? I use (1*1)+(3*2)+(2*4) = 15gigs for this setup, and had 32gigs in the system before upgrading to 64. So, long story short, having Chrome with 50+ tabs open, alongside Discord and VSCode adn Steam and such is <em>not good</em> for your PC rig, and <em>will</em> prevent VMs to start. Quick “fix” would be to turn on your heavy memory stuff <em>after</em> you start all VMs.</p>

<h3 id="administrative-privileges-in-windows">
<a class="anchor" href="#administrative-privileges-in-windows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Administrative privileges in Windows</h3>

<p>To run a command as an administrator in Windows, you need to open PowerShell with administrative privileges. Here are the steps:</p>

<p>Press the Windows key, type PowerShell into the search bar.<br>
Right-click on Windows PowerShell in the search results, and select Run as administrator.<br>
In the administrative PowerShell session we will write our commands, so that we wont need to click thru the interface of Hyper-V Manager.</p>

<h3 id="generate-ssh-keys">
<a class="anchor" href="#generate-ssh-keys" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generate ssh keys</h3>

<p>Get yourself <code class="language-plaintext highlighter-rouge">ssh-keygen</code> and generate key pair to use for SSH login on baremetal. This key will be used for Ansible user <code class="language-plaintext highlighter-rouge">borg</code>. Oh, yea, you would want to have <code class="language-plaintext highlighter-rouge">ansible</code> installed in your WSL.</p>

<h2 id="setup-hyper-v-infrastructure">
<a class="anchor" href="#setup-hyper-v-infrastructure" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup Hyper-V infrastructure</h2>

<p>Alright, after all preparations in place we can create our virtual switch, and VMs.</p>

<p>Enable <code class="language-plaintext highlighter-rouge">RemoteSigned</code> policy, so that you can run locally-created scripts without digital signature.</p>

<h5 id="-shell">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Set-ExecutionPolicy RemoteSigned
</code></pre></div></div>

<h3 id="create-virtual-switch">
<a class="anchor" href="#create-virtual-switch" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create virtual switch</h3>

<p>In the administrative PowerShell session, run your command:</p>

<h5 id="-shell-1">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">New-VMSwitch</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"bridged"</span><span class="w"> </span><span class="nt">-NetAdapterName</span><span class="w"> </span><span class="nx">Ethernet</span><span class="w"> </span><span class="nt">-AllowManagementOS</span><span class="w"> </span><span class="bp">$true</span><span class="w">
</span></code></pre></div></div>

<h5 id="-output">
<i class="fa-solid fa-display"></i> Output:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Name     SwitchType NetAdapterInterfaceDescription
----     ---------- ------------------------------
bridged  External   Intel(R) Ethernet Connection (2) I219-V
</code></pre></div></div>

<p>If we want to be fancy, and we like to do small thingies, we may think - let’s automate that. Yeah, sure let’s to this. Basically what we would do, is to wrap this command and add out default values, all amounting to having following line parametrised.</p>

<h5 id="-devopscreate_vmswitchps1-lines-19">
<i class="fa-solid fa-file-lines"></i> <a href="https://github.com/pgum/pgum.github.io/tree/master/code/devops/create_vmswitch.ps1">devops/create_vmswitch.ps1</a> (lines #19)</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New-VMSwitch -Name "$Name" -NetAdapterName "$NetAdapterName" -AllowManagementOS $AllowManagementOS
</code></pre></div></div>

<h5 id="-shell-2">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./create_vmswitch.ps1 -dryRun $false -Name "bridged"
</code></pre></div></div>

<h5 id="-output-1">
<i class="fa-solid fa-display"></i> Output:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Name     SwitchType NetAdapterInterfaceDescription
----     ---------- ------------------------------
bridged  External   Intel(R) Ethernet Connection (2) I219-V
</code></pre></div></div>

<p>Then, we can check with <a href="https://learn.microsoft.com/en-us/powershell/module/hyper-v/new-vmswitch">documentation</a> that our script don’t cover 70% of the available flags. But it was a nice example on how to write passable powershell script.</p>

<p>Cool! Anyway, whatever method we chose, we end up with network bridge for our little server farm so we can go on.</p>

<h3 id="create-a-bunch-of-vms-configuring-them">
<a class="anchor" href="#create-a-bunch-of-vms-configuring-them" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a bunch of VMs, configuring them</h3>

<p>So now we have our network ready, and our host capable of carrying the task we can create our VMs.<br>
For that we can click thru Hyper-V interface, or again, use powershell.</p>

<h5 id="-shell-3">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="n">/create_vms.ps1</span><span class="w"> </span><span class="nt">-cplaneCount</span><span class="w"> </span><span class="nx">3</span><span class="w"> </span><span class="nt">-workerCount</span><span class="w"> </span><span class="nx">2</span><span class="w"> </span><span class="nt">-vhdBasePath</span><span class="w"> </span><span class="s2">"E:\VMs\hyperv\"</span><span class="w"> </span><span class="se">`
</span><span class="nt">-switchName</span><span class="w"> </span><span class="s2">"bridged"</span><span class="w"> </span><span class="nt">-macPrefix</span><span class="w"> </span><span class="s2">"00155D1B2C"</span><span class="w"> </span><span class="se">`
</span><span class="nt">-haproxyImage</span><span class="w"> </span><span class="s2">"C:\Downloads\CentOS-7-x86_64-Minimal-2009.iso"</span><span class="w"> </span><span class="se">`
</span><span class="nt">-cplaneWorkersImage</span><span class="w"> </span><span class="s2">"C:\Downloads\ubuntu-22.04.4-live-server-amd64.iso"</span><span class="w"> </span><span class="se">`
</span><span class="nt">-prefix</span><span class="w"> </span><span class="s2">"k8s"</span><span class="w"> </span><span class="nt">-dryRun</span><span class="w"> </span><span class="bp">$false</span><span class="w">
</span></code></pre></div></div>

<p>Here are the important bits of the script:</p>

<h5 id="-devopscreate_vmsps1-lines-88---91">
<i class="fa-solid fa-file-lines"></i> <a href="https://github.com/pgum/pgum.github.io/tree/master/code/devops/create_vms.ps1">devops/create_vms.ps1</a> (lines #88 - #91)</h5>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$macAddressGenerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$</span><span class="nn">script</span><span class="p">:</span><span class="nv">macAddressCounter</span><span class="o">++</span><span class="w">
    </span><span class="nv">$</span><span class="nn">script</span><span class="p">:</span><span class="nv">macAddressCounter</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This one generates unique MAC addessess for our VMs.<br>
Then we generate the VM in this part with <code class="language-plaintext highlighter-rouge">function CreateSingleVM($name, $image, ...)</code></p>

<h5 id="-devopscreate_vmsps1-lines-101---108">
<i class="fa-solid fa-file-lines"></i> <a href="https://github.com/pgum/pgum.github.io/tree/master/code/devops/create_vms.ps1">devops/create_vms.ps1</a> (lines #101 - #108)</h5>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="p">}</span><span class="w"> 
    </span><span class="n">New-VM</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nv">$name</span><span class="w"> </span><span class="nt">-MemoryStartupBytes</span><span class="w"> </span><span class="nv">$vmRam</span><span class="w"> </span><span class="nt">-Generation</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-NewVHDPath</span><span class="w"> </span><span class="nv">$vhdFilePath</span><span class="w"> </span><span class="nt">-NewVHDSizeBytes</span><span class="w"> </span><span class="nv">$vmHdd</span><span class="w"> </span><span class="nt">-SwitchName</span><span class="w"> </span><span class="bp">$switch</span><span class="nx">Name</span><span class="w">
    </span><span class="n">Set-VMDvdDrive</span><span class="w"> </span><span class="nt">-VMName</span><span class="w"> </span><span class="nv">$name</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$image</span><span class="w">
    </span><span class="n">Set-VMProcessor</span><span class="w"> </span><span class="nt">-VMName</span><span class="w"> </span><span class="nv">$name</span><span class="w"> </span><span class="nt">-Count</span><span class="w"> </span><span class="nv">$cpu</span><span class="w">
    </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-VMName</span><span class="w"> </span><span class="nv">$name</span><span class="w"> </span><span class="nt">-StaticMacAddress</span><span class="w"> </span><span class="nv">$vmMac</span><span class="w">
    </span><span class="n">Set-VM</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nv">$name</span><span class="w"> </span><span class="nt">-CheckpointType</span><span class="w"> </span><span class="nx">Disabled</span><span class="w">
    </span><span class="n">Set-VMMemory</span><span class="w"> </span><span class="nt">-VMName</span><span class="w"> </span><span class="nv">$name</span><span class="w"> </span><span class="nt">-DynamicMemoryEnabled</span><span class="w"> </span><span class="bp">$false</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Created VM name: </span><span class="nv">$name</span><span class="s2">, MAC: </span><span class="nv">$vmMac</span><span class="s2">, CPU: </span><span class="nv">$cpu</span><span class="s2">, RAM: </span><span class="nv">$vmRam</span><span class="s2">, HDD: </span><span class="nv">$vmHdd</span><span class="s2">. Image path: </span><span class="nv">$image</span><span class="s2">."</span><span class="w">
</span></code></pre></div></div>

<p>We use this function later in <code class="language-plaintext highlighter-rouge">CreateLoadBalancer</code>, <code class="language-plaintext highlighter-rouge">CreateControlPlane</code>, and <code class="language-plaintext highlighter-rouge">CreateWorkers</code> functions.</p>

<h5 id="-devopscreate_vmsps1-lines-143---145">
<i class="fa-solid fa-file-lines"></i> <a href="https://github.com/pgum/pgum.github.io/tree/master/code/devops/create_vms.ps1">devops/create_vms.ps1</a> (lines #143 - #145)</h5>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CreateLoadBalancer</span><span class="w"> </span><span class="s1">'haproxy'</span><span class="w">
</span><span class="n">CreateControlPlane</span><span class="w"> </span><span class="s1">'cplane'</span><span class="w"> </span><span class="nv">$cplaneCount</span><span class="w">
</span><span class="n">CreateWorkers</span><span class="w"> </span><span class="s1">'worker'</span><span class="w"> </span><span class="nv">$workerCount</span><span class="w">
</span></code></pre></div></div>

<h2 id="install-os-on-vms">
<a class="anchor" href="#install-os-on-vms" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install OS on VMs</h2>

<p>During install, I have created user <code class="language-plaintext highlighter-rouge">killme</code>. Everything else except that and hostname I left as is.</p>

<h3 id="haproxy">
<a class="anchor" href="#haproxy" aria-hidden="true"><span class="octicon octicon-link"></span></a>HAProxy</h3>

<p>For <code class="language-plaintext highlighter-rouge">haproxy.k8s.local</code> we go thru CentOS install.<br>
HAProxy is a free, very fast, and reliable solution offering high availability, load balancing, and proxying for TCP and HTTP-based applications. It is particularly suited for web sites crawling under very high loads while needing persistence or Layer7 processing.</p>

<p>This node is super light and meant to host haproxy software that function as reverse proxy for control plane node. This way all requests go to <code class="language-plaintext highlighter-rouge">haproxy.k8s.local</code> node, and it forwards them to one of control plane nodes.</p>

<p>We need to create configuration file for HAProxy, that will reside in <code class="language-plaintext highlighter-rouge">/etc/haproxy/haproxy.cfg</code></p>

<h5 id="-devopsansiblehaproxycfg-lines-20---24">
<i class="fa-solid fa-file-lines"></i> <a href="https://github.com/pgum/pgum.github.io/tree/master/code/devops/ansible/haproxy.cfg">devops/ansible/haproxy.cfg</a> (lines #20 - #24)</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>frontend kube-apiserver
  bind *:8383
  mode tcp
  option tcplog
  default_backend kube-apiserver
</code></pre></div></div>

<p>We create frontend named <code class="language-plaintext highlighter-rouge">kube-apiserver</code> that binds on port 8383 in tcp. It will forward whatever comes to backend named <code class="language-plaintext highlighter-rouge">kube-apiserver</code>.</p>

<h5 id="-devopsansiblehaproxycfg-lines-26---34">
<i class="fa-solid fa-file-lines"></i> <a href="https://github.com/pgum/pgum.github.io/tree/master/code/devops/ansible/haproxy.cfg">devops/ansible/haproxy.cfg</a> (lines #26 - #34)</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>backend kube-apiserver
    mode tcp
    option tcplog
    option tcp-check
    balance roundrobin
    default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100
    server cplane-0 10.0.10.201:6443 check
    server cplane-1 10.0.10.202:6443 check
    server cplane-2 10.0.10.203:6443 check
</code></pre></div></div>

<p>Here we create backend we referenced just before. What is worth notice here is <code class="language-plaintext highlighter-rouge">balance roundrobin</code> and <code class="language-plaintext highlighter-rouge">server</code> definitions.</p>

<p>The <code class="language-plaintext highlighter-rouge">balance</code> directive is used to set the load balancing algorithm to be used in a backend. This algorithm decides which server, from a backend, will be selected to process each incoming request. The <code class="language-plaintext highlighter-rouge">roundrobin</code> algorithm is one of the simplest and most commonly used algorithms. It distributes client requests across all servers sequentially.</p>

<p>The lines of code define three servers that HAProxy will distribute traffic to. Each <code class="language-plaintext highlighter-rouge">server</code> directive specifies a server for HAProxy to route requests to. Note that <code class="language-plaintext highlighter-rouge">cplane-{0..2}</code> are arbitrary labels, what matters is <code class="language-plaintext highlighter-rouge">IP:port</code>. Last option in line is <code class="language-plaintext highlighter-rouge">check</code> which tells HAProxy to periodically confirm the health of the server. Requests are forwarder to other instances until server passes the heath check again.</p>

<h3 id="control-plane-and-worker-nodes">
<a class="anchor" href="#control-plane-and-worker-nodes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Control plane and worker nodes</h3>

<p>Cplane and worker nodes are based on Ubuntu. We use version that is supported by kubespray. On these nodes, only prep to be done is to create <code class="language-plaintext highlighter-rouge">borg</code> user.</p>

<h3 id="ansible-part-1">
<a class="anchor" href="#ansible-part-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ansible part 1</h3>

<p>For our use case we see few tasks at hand which we could do manually, and its fun and usually educational to do it like that for the first time. It’s also fun to look for ways to optimize and go further into automation, hence we will use power of ansible.</p>

<p>Ansible is an open-source automation tool that provides a framework for defining and deploying system configuration across a wide range of environments. It uses yaml to define automation jobs. We are going to use this tool in very basic way ourselves, and later see how it is used by kubespray to automate cluster creation.</p>

<p>Make sure you have <code class="language-plaintext highlighter-rouge">ansible</code> installed. I run <code class="language-plaintext highlighter-rouge">ansible 2.9.6</code> with <code class="language-plaintext highlighter-rouge">python version = 3.8.10 (default, Nov 22 2023, 10:22:35) [GCC 9.4.0]</code> in WSL.</p>

<p>The very tl;dr version on using ansible is:</p>
<ul>
  <li>set your inventory (so that ansible knows what machines to do work on)</li>
  <li>get your files in place (ie. <code class="language-plaintext highlighter-rouge">id_rsa.pub</code>, so that playbook can use its content)</li>
  <li>run your playbook
I encourage anyone to dig into ansible a bit, its very cool tool that lets you work on multiple servers at once, it also makes knowledge sharing among peers easier, and serves as executable documentation on how to set the system. Lets look at <a href="https://github.com/pgum/pgum.github.io/tree/master/code/devops/ansible">ansible directory</a>.</li>
</ul>

<p>Before use, change <code class="language-plaintext highlighter-rouge">private_key_file = /path/to/your/.ssh/</code> line in <code class="language-plaintext highlighter-rouge">ansible.cfg</code> or pass that variable with <code class="language-plaintext highlighter-rouge">--private-key PRIVATE_KEY_FILE</code> flag.</p>

<p>We can test our connection, and if config is ok with:</p>

<h5 id="-shell-4">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook ping.yaml --user=killme
</code></pre></div></div>

<h5 id="-outputlines-19---24">
<i class="fa-solid fa-display"></i> Output:(lines #19 - #24)</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cplane-0.k8s.local         : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
cplane-1.k8s.local         : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
cplane-2.k8s.local         : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
haproxy.k8s.local          : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
worker-0.k8s.local         : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
worker-1.k8s.local         : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre></div></div>

<p>What you want to do is copy your <code class="language-plaintext highlighter-rouge">~/.ssh/id_rsa.pub</code> file here, and run setup ansible user playbook, so that every node is reachable from one service user, that has admin access, and can be ssh’ed into with your key.</p>

<h5 id="-shell-5">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook setup_ansible_user.yaml --user=killme
</code></pre></div></div>

<h5 id="-outputlines-42-51">
<i class="fa-solid fa-display"></i> Output:(lines #42, 51)</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TASK [Copy SSH key] ************************************************************************************
cplane-0.k8s.local         : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre></div></div>

<p>Next, run load balancer playbook to set up haproxy node.</p>

<h5 id="-shell-6">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook load_balancer.yaml
</code></pre></div></div>

<h5 id="-outputlines-21">
<i class="fa-solid fa-display"></i> Output:(lines #21)</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>haproxy.k8s.local          : ok=6    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre></div></div>

<p>Now we have everything ready to run kubespray on top of our setup.</p>

<h2 id="spraying-k8s-cluster-on-top">
<a class="anchor" href="#spraying-k8s-cluster-on-top" aria-hidden="true"><span class="octicon octicon-link"></span></a>Spraying k8s cluster on top</h2>

<p>Kubespray is an open-source project that provides Ansible playbooks for the deployment and management of Kubernetes clusters. 
Few things we are going to do are:</p>
<ul>
  <li>get kubespray repo - <code class="language-plaintext highlighter-rouge">git clone https://github.com/kubernetes-sigs/kubespray.git</code>
</li>
  <li>set yourself <code class="language-plaintext highlighter-rouge">virtualenv --python=$(which python3) kubespray-venv</code>, activate it</li>
  <li>install deps <code class="language-plaintext highlighter-rouge">pip install -U -r requirements.txt</code>
</li>
</ul>

<p>Now we copy and customize <code class="language-plaintext highlighter-rouge">inventory/sample</code> as per README from kubespray repo.<br>
There are some things we want to change before we spray.</p>

<p>in <code class="language-plaintext highlighter-rouge">mycluster/group_vars/all/all.yml</code> we change entries about load balancer and dns.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiserver_loadbalancer_domain_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">haproxy.k8s.local"</span>
<span class="na">loadbalancer_apiserver</span><span class="pi">:</span>
  <span class="na">address</span><span class="pi">:</span> <span class="s">10.0.10.200</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8383</span>

<span class="na">loadbalancer_apiserver_type</span><span class="pi">:</span> <span class="s">haproxy</span>  <span class="c1"># valid values "nginx" or "haproxy"</span>

<span class="na">upstream_dns_servers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">8.8.8.8</span>
  <span class="pi">-</span> <span class="s">8.8.4.4</span>
</code></pre></div></div>
<p>In <code class="language-plaintext highlighter-rouge">mycluster/group_vars/k8s_cluster/k8s-cluster.yml</code> we change entries considering which network controller to use.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kube_network_plugin</span><span class="pi">:</span> <span class="s">flannel</span>
</code></pre></div></div>

<p>For me, other network plugins didn’t work, and I have not yet dig into why.</p>

<p>In <code class="language-plaintext highlighter-rouge">mycluster/group_vars/k8s_cluster/addons.yml</code> for basic version of the system we can basically set everything to false. We will leave metrics turned on.</p>

<p>Our <code class="language-plaintext highlighter-rouge">inventory.ini</code> file has to match predefined labels that kubespray</p>

<h5 id="-devopsmyclusterinventoryini">
<i class="fa-solid fa-file-lines"></i> <a href="https://github.com/pgum/pgum.github.io/tree/master/code/devops/mycluster/inventory.ini">devops/mycluster/inventory.ini</a>
</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[all]

[kube_control_plane]
cplane-0 ansible_host=10.0.10.201
cplane-1 ansible_host=10.0.10.202
cplane-2 ansible_host=10.0.10.203

[etcd]
cplane-0 ansible_host=10.0.10.201
cplane-1 ansible_host=10.0.10.202
cplane-2 ansible_host=10.0.10.203

[kube_node]
worker-0 ansible_host=10.0.10.204
worker-1 ansible_host=10.0.10.205

[calico_rr]

[k8s_cluster:children]
kube_control_plane
kube_node
calico_rr

</code></pre></div></div>

<p>Now we can spray it!</p>

<h5 id="-shell-7">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook -i inventory/mycluster/hosts.yaml -u borg -b -v --private-key=~/.ssh/id_rsa cluster.yml
</code></pre></div></div>

<p>In case of failure, it is safe to run <code class="language-plaintext highlighter-rouge">reset.yml</code> playbook, to redo the procedure.</p>

<h5 id="-shell-8">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook -i inventory/mycluster/hosts.yaml -u borg -b -v --private-key=~/.ssh/id_rsa reset.yml
</code></pre></div></div>

<h2 id="getting-k8s-credentials">
<a class="anchor" href="#getting-k8s-credentials" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting k8s credentials</h2>
<p>After kubespray finishes its job, you can use our primitive ansible playbook fetch conf to download <code class="language-plaintext highlighter-rouge">admin.conf</code> file that serves as credentials file for the cluster.</p>

<h5 id="-shell-9">
<i class="fa-solid fa-terminal"></i> Shell:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook fetch_conf.yaml 
</code></pre></div></div>

<h5 id="-output-2">
<i class="fa-solid fa-display"></i> Output:</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PLAY [Copy admin.conf file from remote node to host] ***************************************************

TASK [Fetch admin.conf] ********************************************************************************
changed: [cplane-0.k8s.local]

PLAY RECAP *********************************************************************************************
cplane-0.k8s.local         : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre></div></div>

<p>So now we have our conf file ready in our system.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-al</span> ./admin.conf 
<span class="nt">-rw-r--r--</span> 1 killme killme 5673 Apr 17 13:56 ./admin.conf
</code></pre></div></div>
<p>Keep it somewhere where it wont get lost. File path to this file is exported in the shell as <code class="language-plaintext highlighter-rouge">KUBECONFIG</code> variable, and before using <code class="language-plaintext highlighter-rouge">kubectl</code> it needs to be set, for example with <code class="language-plaintext highlighter-rouge">export KUBECONFIG=/path/to/your/conf</code> so that kubernetes knows which cluster are we refering to when making api calls.</p>

<p>So after applying our export, we are able to do <code class="language-plaintext highlighter-rouge">kubectl get pods -A</code>. Depending on default addons turned on, there might be some pods spinning up already.</p>

<h2 id="possible-upgrades-in-the-future">
<a class="anchor" href="#possible-upgrades-in-the-future" aria-hidden="true"><span class="octicon octicon-link"></span></a>Possible upgrades in the future</h2>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>Divide this article into two parts - infrastructure setup and spray.</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>Write up how to set up DNS in your network</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>Write up how to set up OS install over the network</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>Write up procedure to set up infra on virtualbox</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>Write Hyper-V set up in terraform, write up how to set up providers</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>Compile terraform step into separate article</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>Dig into spraying more, try out more options, turn on more addons</li>
</ul>
 
    </div>
  </div>
</div>


    <button id="scroll-to-top-button" title="Go to top">Top</button>
    
<footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          <li>
  <a href="/feed.xml" title="RSS">
    <span class="fa-stack fa-lg" aria-hidden="true">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
    </span>
    <span class="sr-only">RSS</span>
  </a>
</li>
<li>
    <a href="mailto:pjgumulka@gmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
    </a>
  </li>
<li>
    <a href="tel:517%20463%20789" title="Phone">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-solid fa-phone fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Phone</span>
    </a>
  </li>
<li>
    <a href="https://github.com/pgum" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-brands fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>
<li>
    <a href="https://linkedin.com/in/piotr-gumulka" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-brands fa-linkedin-in fa-stack-1x fa-inverse fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
    </a>
  </li>
<li>
    <a href="https://www.youtube.com/turtleCalledCalmie" title="YouTube">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-brands fa-youtube fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">YouTube</span>
    </a>
  </li>
        </ul>
      <p class="copyright text-muted">
      Piotr Jacek Gumulka
       • 
      2024

      
       • 
      <a class="site-pretty-url" href="">gumulka.net</a>
      
       • 
      <a class="site-support-kofi" href="https://ko-fi.com/S6S11H353">Support Me on Ko-fi</a>
       • 
      <a class="site-pretty-url" href="https://github.com/pgum/pgum.github.io/issues"> Leave feedback</a>
    </p>
    <p class="theme-by text-muted">
      Theme by <a class="theme-author-link" href="https://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a><a href="https://github.com/daattali/beautiful-jekyll/blob/master/LICENSE">(MIT)</a> 
      Resume theme made by <a href="http://themes.3rdwavemedia.com" target="_blank" rel="nofollow">Xiaoying Riley</a>, made into jekyll theme <a href="https://github.com/sharu725/online-cv" target="_blank" rel="nofollow">online-cv</a> by sharu725 <i class="fas fa-heart"></i><br>
    </p>
    <p class="hosted-on text-muted">
      <a class="site-pretty-url" href="https://github.com/pgum/pgum.github.io"> Hosted on Github <i class="fas fa-heart"></i></a>
    </p>
      </div>
    </div>
  </div>
</footer>

  
    


  
    
      <script src="/assets/js/bootstrap.min.js"></script>
    
  
    
      <script src="/assets/js/main.js"></script>
    
  
    
      <script src="/assets/js/scroll-to-top.js"></script>
    
  






      

  </body>
</html>
